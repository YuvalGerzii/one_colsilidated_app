<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Test - Portfolio Dashboard</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            max-width: 1200px;
            margin: 40px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 { color: #1976d2; margin-top: 0; }
        h2 { color: #333; border-bottom: 2px solid #1976d2; padding-bottom: 10px; }
        .status { display: flex; gap: 10px; align-items: center; margin: 10px 0; }
        .status-indicator { width: 12px; height: 12px; border-radius: 50%; }
        .status-ok { background: #4caf50; }
        .status-error { background: #f44336; }
        .data-section { margin: 20px 0; padding: 15px; background: #f9f9f9; border-radius: 4px; }
        pre { background: #2d2d2d; color: #f8f8f2; padding: 15px; border-radius: 4px; overflow-x: auto; }
        button {
            background: #1976d2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        button:hover { background: #1565c0; }
        .company-card {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            background: white;
        }
        .company-name { font-weight: bold; font-size: 16px; color: #1976d2; }
        .company-detail { color: #666; margin: 5px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Portfolio Dashboard API Test</h1>
        <p>This page tests if your browser can fetch data from the API.</p>

        <h2>System Status</h2>
        <div id="status-section">
            <div class="status">
                <div class="status-indicator" id="backend-status"></div>
                <span>Backend API (http://localhost:8000)</span>
            </div>
            <div class="status">
                <div class="status-indicator" id="proxy-status"></div>
                <span>Frontend Proxy (/api/v1/companies/)</span>
            </div>
        </div>

        <div style="margin: 20px 0;">
            <button onclick="testBackend()">Test Backend API</button>
            <button onclick="testProxy()">Test Frontend Proxy</button>
            <button onclick="testBoth()">Test Both</button>
            <button onclick="clearResults()">Clear</button>
        </div>

        <h2>Results</h2>
        <div id="results"></div>
    </div>

    <script>
        async function testBackend() {
            showLoading();
            try {
                const response = await fetch('http://localhost:8000/api/v1/companies/');
                const data = await response.json();

                document.getElementById('backend-status').className = 'status-indicator status-ok';

                const html = `
                    <div class="data-section">
                        <h3>‚úÖ Backend API Response</h3>
                        <p><strong>Status:</strong> ${response.status} ${response.statusText}</p>
                        <p><strong>Companies Found:</strong> ${data.length}</p>
                        ${data.slice(0, 3).map(company => `
                            <div class="company-card">
                                <div class="company-name">${company.company_name}</div>
                                <div class="company-detail">Sector: ${company.sector}</div>
                                <div class="company-detail">Status: ${company.company_status}</div>
                                <div class="company-detail">Revenue: $${parseFloat(company.entry_revenue || 0).toLocaleString()}</div>
                            </div>
                        `).join('')}
                        <details>
                            <summary>View Full JSON Response</summary>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </details>
                    </div>
                `;
                document.getElementById('results').innerHTML = html;
            } catch (error) {
                document.getElementById('backend-status').className = 'status-indicator status-error';
                showError('Backend API', error);
            }
        }

        async function testProxy() {
            showLoading();
            try {
                const response = await fetch('/api/v1/companies/');
                const data = await response.json();

                document.getElementById('proxy-status').className = 'status-indicator status-ok';

                const html = `
                    <div class="data-section">
                        <h3>‚úÖ Frontend Proxy Response</h3>
                        <p><strong>Status:</strong> ${response.status} ${response.statusText}</p>
                        <p><strong>Companies Found:</strong> ${data.length}</p>
                        <p><strong>Data Structure Check:</strong></p>
                        <ul>
                            <li>Has company_id: ${data[0]?.company_id ? '‚úÖ Yes' : '‚ùå No'}</li>
                            <li>Has company_name: ${data[0]?.company_name ? '‚úÖ Yes' : '‚ùå No'}</li>
                            <li>Has entry_revenue: ${data[0]?.entry_revenue ? '‚úÖ Yes' : '‚ùå No'}</li>
                            <li>Has sector: ${data[0]?.sector ? '‚úÖ Yes' : '‚ùå No'}</li>
                        </ul>
                        ${data.slice(0, 3).map(company => `
                            <div class="company-card">
                                <div class="company-name">${company.company_name}</div>
                                <div class="company-detail">ID: ${company.company_id}</div>
                                <div class="company-detail">Sector: ${company.sector}</div>
                                <div class="company-detail">Status: ${company.company_status}</div>
                            </div>
                        `).join('')}
                        <details>
                            <summary>View Full JSON Response</summary>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </details>
                    </div>
                `;
                document.getElementById('results').innerHTML = html;
            } catch (error) {
                document.getElementById('proxy-status').className = 'status-indicator status-error';
                showError('Frontend Proxy', error);
            }
        }

        async function testBoth() {
            await testBackend();
            setTimeout(async () => {
                const results = document.getElementById('results');
                const backendHtml = results.innerHTML;
                await testProxy();
                const proxyHtml = results.innerHTML;
                results.innerHTML = backendHtml + proxyHtml;
            }, 100);
        }

        function showLoading() {
            document.getElementById('results').innerHTML = '<div class="data-section">‚è≥ Loading...</div>';
        }

        function showError(source, error) {
            document.getElementById('results').innerHTML = `
                <div class="data-section" style="border-left: 4px solid #f44336;">
                    <h3>‚ùå ${source} Error</h3>
                    <p><strong>Message:</strong> ${error.message}</p>
                    <p><strong>Error:</strong></p>
                    <pre>${error.stack || error.toString()}</pre>
                    <p><strong>Possible Causes:</strong></p>
                    <ul>
                        <li>Backend server not running (check http://localhost:8000)</li>
                        <li>CORS issue (should be resolved by proxy)</li>
                        <li>Network connectivity</li>
                        <li>Browser blocking requests</li>
                    </ul>
                </div>
            `;
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '<p style="color: #999;">No tests run yet. Click a button above to test the API.</p>';
            document.getElementById('backend-status').className = 'status-indicator';
            document.getElementById('proxy-status').className = 'status-indicator';
        }

        // Auto-test on page load
        window.addEventListener('load', () => {
            console.log('üîç API Test Page Loaded');
            testBoth();
        });
    </script>
</body>
</html>
