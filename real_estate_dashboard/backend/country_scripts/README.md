# Country Update Scripts

This directory contains individual update scripts for each country.

## Generated Scripts

- `update_australia.py` - Updates data for **Australia**
- `update_brazil.py` - Updates data for **Brazil**
- `update_canada.py` - Updates data for **Canada**
- `update_china.py` - Updates data for **China**
- `update_euro_area.py` - Updates data for **Euro Area**
- `update_france.py` - Updates data for **France**
- `update_germany.py` - Updates data for **Germany**
- `update_india.py` - Updates data for **India**
- `update_indonesia.py` - Updates data for **Indonesia**
- `update_italy.py` - Updates data for **Italy**
- `update_japan.py` - Updates data for **Japan**
- `update_mexico.py` - Updates data for **Mexico**
- `update_netherlands.py` - Updates data for **Netherlands**
- `update_poland.py` - Updates data for **Poland**
- `update_russia.py` - Updates data for **Russia**
- `update_saudi_arabia.py` - Updates data for **Saudi Arabia**
- `update_south_korea.py` - Updates data for **South Korea**
- `update_spain.py` - Updates data for **Spain**
- `update_switzerland.py` - Updates data for **Switzerland**
- `update_taiwan.py` - Updates data for **Taiwan**
- `update_turkey.py` - Updates data for **Turkey**
- `update_united_kingdom.py` - Updates data for **United Kingdom**
- `update_united_states.py` - Updates data for **United States**

## Usage

### Run a Single Country Update

```bash
cd /home/user/real_estate_dashboard/backend
python3 country_scripts/update_united_states.py
```

### Run with Options

```bash
# Force refresh all data
python3 country_scripts/update_china.py --force-refresh

# Only update if data is older than 3 days
python3 country_scripts/update_japan.py --max-age-days 3

# With custom delay to avoid rate limiting
python3 country_scripts/update_germany.py --delay 1.0
```

### Set Up Cron Job for a Country

Add to crontab:
```bash
# Update United States data every Sunday at 2 AM
0 2 * * 0 cd /home/user/real_estate_dashboard/backend && python3 country_scripts/update_united_states.py >> logs/united_states_update.log 2>&1

# Update China data every Monday at 3 AM
0 3 * * 1 cd /home/user/real_estate_dashboard/backend && python3 country_scripts/update_china.py >> logs/china_update.log 2>&1
```

## Features

Each script:
- ✅ Fetches all 11 economic categories
- ✅ Smart caching - only updates stale data (>7 days old)
- ✅ Stores in database with country-specific tables
- ✅ Logs all operations
- ✅ Reports errors and statistics
- ✅ Can be run via cron or manually

## Database Storage

All data is stored in PostgreSQL tables:
- `economics_country_overview` - Country snapshots
- `economics_indicators` - Individual indicators by category
- `economics_indicator_history` - Time-series data

Filter by country name in queries:
```python
from app.services.economics_db_service import EconomicsDBService
from app.models.database import SessionLocal

db = SessionLocal()
service = EconomicsDBService(db)

# Get United States housing data
us_housing = service.get_economic_indicators(
    country="United States",
    category="housing"
)
```

## Monitoring

View logs:
```bash
# View recent updates
tail -f logs/united_states_update.log

# Check all country logs
tail -f logs/*_update.log
```

Query database for freshness:
```python
freshness = service.get_data_freshness("United States")
print(f"Last updated: {{freshness['overview_last_updated']}}")
```

---

Generated by: `generate_country_scripts.py`
